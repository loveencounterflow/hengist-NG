{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/demo-node-sqlite.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n#===========================================================================================================\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'demo-node-sqlite'\n{ rpr\n  inspect\n  echo\n  white\n  green\n  blue\n  gold\n  grey\n  red\n  bold\n  reverse\n  log     }               = GUY.trm\n{ f }                     = require '../../../apps/effstring'\n# write                     = ( p ) -> process.stdout.write p\n{ nfa }                   = require '../../../apps/normalize-function-arguments'\nGTNG                      = require '../../../apps/guy-test-NG'\n{ Test                  } = GTNG\nSFMODULES                 = require '../../../apps/bricabrac-single-file-modules'\nmkdirp                    = require 'mkdirp'\nenv_paths                 = ( require 'env-paths' ).default 'demo-node-sqlite'\nS                         = require 'node:sqlite'\nPATH                      = require 'node:path'\n{ SQL }                   = require '../../../apps/dbay'\n\n\n#===========================================================================================================\nillegal_codepoint_patterns =\n  unassigned: ///^\\p{Cn}$///v # Control\n  control:    ///^\\p{C}$///v # Control\n  letter:     ///^\\p{L}$///v\n  space:      ///^\\p{Zs}$///v\n  separator:  ///^\\p{Z}$///v\n  mark:       ///^\\p{M}$///v\n  # surrogate:  ///^\\p{C}$///v # Surrogate\n\nget_rough_unicode_category = ( chr ) ->\n  for name, pattern of illegal_codepoint_patterns\n    return name if pattern.test chr\n  return 'other'\n\n\n#===========================================================================================================\ndemo = =>\n  debug 'Ωnql___1', k, v for k, v of env_paths\n  tmp_path  = env_paths.temp\n  db_path   = PATH.join tmp_path, 'chr-widths.sqlite'\n  debug 'Ωnql___2', mkdirp.sync tmp_path\n  debug 'Ωnql___3', db = new S.DatabaseSync db_path\n  #.........................................................................................................\n  db.exec SQL\"\"\"drop table if exists segments;\"\"\"\n  #.........................................................................................................\n  db.exec SQL\"\"\"\n    create table segments (\n      segment_text      text    not null primary key,\n      segment_width     integer not null,\n      segment_length    integer not null,\n      constraint segment_width_eqgt_zero  check ( segment_width >= 0  ),\n      constraint segment_length_eqgt_zero check ( segment_length >= 0 ) );\"\"\"\n  #.........................................................................................................\n  insert_segment = db.prepare SQL\"\"\"insert\n    into segments ( segment_text, segment_width, segment_length )\n    values ( $segment_text, $segment_width, $segment_length )\n    on conflict ( segment_text ) do update\n      set ( segment_width, segment_length ) = ( excluded.segment_width, excluded.segment_length );\"\"\"\n  #.........................................................................................................\n  all_segments = db.prepare SQL\"\"\"select * from segments order by segment_text;\"\"\"\n  #.........................................................................................................\n  db.exec SQL\"\"\"begin transaction;\"\"\"\n  for cid in [ 0x00_0000 .. 0x00_00ff ]\n    chr     = String.fromCodePoint cid\n    cid_hex = \"U+#{( cid.toString 16 ).padStart 4, '0'}\"\n    chr     = String.fromCodePoint cid\n    ucc     = get_rough_unicode_category chr\n    # debug 'Ωbbsfm___4', cid_hex, ( rpr chr ), ucc\n    segment_text    = chr\n    segment_width   = null\n    segment_length  = null\n    switch ucc\n      when 'control'\n        segment_width   = 0\n        segment_length  = 0\n      when 'separator'\n        segment_width   = 0\n        segment_length  = 0\n      else\n        segment_width   = 1 ### TAINT run wc --max-line-length ###\n        segment_length  = 1\n    insert_segment.run { segment_text, segment_width, segment_length, }\n  db.exec SQL\"\"\"commit;\"\"\"\n  for { segment_text, segment_width, segment_length, } from all_segments.iterate()\n    info 'Ωnql___5', ( rpr segment_text ), segment_width, segment_length\n  #.........................................................................................................\n  # some_segments = db.prepare SQL\"\"\"select * from segments where segment_text in ( $texts );\"\"\"\n  # debug 'Ωnql___6', some_segments.run { texts: [ 'a', 'b', ], }\n  some_segments = db.prepare SQL\"\"\"select * from segments where segment_text in (\n    select value from json_each(?) );\"\"\"\n  # some_segments.setReturnArrays true\n  for segment, idx in some_segments.all ( JSON.stringify [ 'a', 'b', ] )\n    urge 'Ωnql___7', ( rpr segment ), segment\n  #.........................................................................................................\n  return null\n\n#===========================================================================================================\nif module is require.main then await do =>\n  await demo()\n  return null\n"
  ]
}